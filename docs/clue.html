<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head><title>Ivory: A Hadoop toolkit for Web-scale information retrieval</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>

<center><table width="80%"><tbody><tr><td align="left">

<h2>Ivory: Getting started with the ClueWeb09 collection</h2>

<div class="main">

<h3>Introduction</h3>

<p>This tutorial will take you through building an inverted index on
the English portion of the ClueWeb09 collection (504m pages, 2.08 TB
compressed, 13.4 TB uncompressed) and starting a server architecture
to perform searches.  We're assuming you have access to a
reasonably-sized Hadoop cluster that is capable of holding the
collection in uncompressed form.  Since Ivory was designed to be
scalable, the indexing process is basically the same
as <a href="trec.html">working with TREC disks 4-5</a>; you might want
to go through that guide first before tackling a multi-terabyte
collection.</p>

<p>Ivory relies extensively on APIs for processing the ClueWeb09
collection provided
in <a href="http://www.umiacs.umd.edu/~jimmylin/cloud9/docs/index.html">Cloud<sup><small>9</small></sup></a>,
a MapReduce library for Hadoop developed at the University of
Maryland: see this
page <a href="http://www.umiacs.umd.edu/~jimmylin/cloud9/docs/content/clue.html">dedicated
to working with the ClueWeb09 collection</a>.  You'll want to start
there.</p>

<h3>Indexing the segments</h3>

<p>In total, there are 503,903,810 pages in the English portion of the
ClueWeb09 collection. The English data is distributed in ten parts
(called segments), each corresponding to a directory. Here are the
page counts for each segment:</p>

<pre>
ClueWeb09_English_1    50,220,423 pages
ClueWeb09_English_2    51,577,077 pages
ClueWeb09_English_3    50,547,493 pages
ClueWeb09_English_4    52,311,060 pages
ClueWeb09_English_5    50,756,858 pages
ClueWeb09_English_6    50,559,093 pages
ClueWeb09_English_7    52,472,358 pages
ClueWeb09_English_8    49,545,346 pages
ClueWeb09_English_9    50,738,874 pages
ClueWeb09_English_10   45,175,228 pages
</pre>

<p>It's easiest to work with the collection in uncompressed form (as
SequenceFiles), so you'll want to first uncompress the distribution
WARC files.  Use a program in Cloud<sup><small>9</small></sup> for
this:</p>

<pre>
hadoop jar cloud9.jar edu.umd.cloud9.collection.clue.UncompressClueWarcRecords \
/umd/collections/ClueWeb09 /umd/collection/clue.en.segment.01 1
</pre>

<p>The first command-line argument is the base path of your ClueWeb09
distribution; the second is the output path; the third is the segment
number (1 through 10).  You'll want to uncompress all 10 segments.</p>

<p>After that, you can use a driver program in Ivory to build an index
on each segment.  Sample invocation:</p>

<pre>
hadoop jar ivory.jar ivory.demo.DriverBuildIndexClueWebEnglish \
/umd/collections/clue.en.segment.01/ /umd/indexes/clue.en.segment.01/ 1
</pre>

<p>The first command-line argument is the location of the source
SequenceFiles containing the WARC records; the second is the location
of the index; the third is segment number (one through ten).  The
cluster should fire up and start performing the indexing.  Depending
on the size of your cluster, this may take a while, or not very long
at all...</p>

<h3>Searching the collection</h3>

<p>Ivory uses a standard architecture where a broker forwards queries
to independent retrieval servers, each responsible for a partition of
the collection (each partition is sometimes called a "shard").  See
the figure below:</p>

<p><img width="450" src="images/broker-architecture.png" alt="broker architecture"/></p>

<p>In the case of the ClueWeb09 collection, the segments provide
natural document partitions.  The query broker receives user queries
(via a Web interface), forwards them to all the retrieval servers (in
parallel), and merges the results.  Here's the invocation for starting
up the retrieval servers:</p>

<pre>
hadoop jar ivory.jar ivory.http.server.RetrievalServer bm25 /user/jimmylin/ivory-servers/ \
/umd/indexes/clue.en.segment.01 \
/umd/indexes/clue.en.segment.02 \
/umd/indexes/clue.en.segment.03 \
/umd/indexes/clue.en.segment.04 \
/umd/indexes/clue.en.segment.05 \
/umd/indexes/clue.en.segment.06 \
/umd/indexes/clue.en.segment.07 \
/umd/indexes/clue.en.segment.08 \
/umd/indexes/clue.en.segment.09 \
/umd/indexes/clue.en.segment.10
</pre>

<p>The first command-line argument indicates use of the <i>bm25</i>
retrieval model; the second command-line argument names a path in HDFS
for storing configuration information; the rest of the command-line
arguments specify the different index locations.  As described in 
<a href="trec.html">the guide on working with TREC disks 4-5</a>, a
Jetty server in embedded inside each mapper.  Each Jetty server has an
instance of a query engine that directly reads postings from HDFS.</p>

<p>Here's the invocation for starting up the broker:</p>

<pre>
hadoop jar ivory.jar ivory.http.broker.RetrievalBroker /user/jimmylin/ivory-servers/
</pre>

<p>The only command-line argument to the broker is the HDFS path where
configuration information was written.  When you fire up the broker,
it returns a hostname:port where you can access a simple search
interface.  We don't have accurate efficiency measures yet, but a
search on the entire collection takes several seconds.</p>

<p>And that's it!</p>

<p style="padding-top: 25px"><a href="./index.html">Back to main page</a></p>

</div>

<table width="100%" border="0" cellpadding="0" cellspacing="0" style="padding-top: 10px;">
<tr><td valign="top" align="left">
<small>
This page, first created: 30 Jun 2009; last updated:
<script language="JavaScript" type="text/javascript">
<!--
var LastUpdated = "$Date: 2009-07-15 18:11:38 -0400 (Wed, 15 Jul 2009) $";
LastUpdated = LastUpdated.substring(LastUpdated.length-14, LastUpdated.length-3);
document.writeln (LastUpdated);
-->
</script>
</small>
</td>
<td valign="top" align="right">
  <a href="http://creativecommons.org/licenses/by-nc-sa/3.0/us/">
  <img src="images/creative-commons.png" border="0" alt="Creative Commons: Attribution-Noncommercial-Share Alike 3.0 United States"/>
  </a>
  <a href="http://validator.w3.org/check/referer">
  <img src="images/valid-xhtml10.gif" border="0"
       alt="Valid XHTML 1.0!" height="31" width="88" />
  </a>
  <a href="http://jigsaw.w3.org/css-validator/check/referer">
  <img style="border:0;width:88px;height:31px"
       src="images/vcss.gif" 
       alt="Valid CSS!" />
  </a>
</td></tr></table>


</td></tr></tbody></table></center>

</body></html>
